<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ğŸ“¹ Live Stream</title>
<style>
body{
  margin:0;background:#111;color:white;font-family:Arial;display:flex;
  justify-content:center;align-items:center;height:100vh;flex-direction:column;
}
h2{margin-bottom:20px;}
#videoBox{border:3px solid #04F5C0;border-radius:10px;width:340px;height:240px;
  display:flex;justify-content:center;align-items:center;background:#000;}
button{padding:12px 20px;margin-top:15px;background:#04F5C0;border:none;
  color:#000;font-weight:bold;border-radius:8px;cursor:pointer;width:220px;}
button:hover{opacity:.8;}
</style>
</head>
<body>

<h2>ğŸ“¹ Live Stream</h2>

<div id="videoBox">
  <video id="video" autoplay playsinline muted style="width:100%;height:100%;border-radius:10px;"></video>
</div>

<button onclick="startEmployee()">ğŸ‘¨â€ğŸ’» Start as Employee (Send)</button>
<button onclick="startAdmin()">ğŸ‘ï¸ Start as Admin (View)</button>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase.js"></script>

<script>
  // ğŸ”¥ Your Firebase Config
  firebase.initializeApp({
    apiKey: "AIzaSyC1MQzKtdzp0dr0Z8HEFr7XezbvyGUdMV8",
    authDomain: "web-app-b59be.firebaseapp.com",
    databaseURL: "https://web-app-b59be-default-rtdb.firebaseio.com",
    projectId: "web-app-b59be",
    storageBucket: "web-app-b59be.appspot.com",
    messagingSenderId: "916960538508",
    appId: "1:916960538508:web:d0988676fe0952539c70a9",
    measurementId: "G-6XVYFG6GD2"
  });

  const db = firebase.database();
  let peer;

  // ğŸ§‘â€ğŸ’» Employee Side (Sender)
  async function startEmployee(){
    const stream = await navigator.mediaDevices.getUserMedia({ video:true, audio:false });
    document.getElementById("video").srcObject = stream;

    peer = new RTCPeerConnection();

    stream.getTracks().forEach(track => peer.addTrack(track, stream));

    // Send ICE candidates
    peer.onicecandidate = e => {
      if(e.candidate){
        db.ref("employeeCandidates").push(e.candidate.toJSON());
      }
    };

    const offer = await peer.createOffer();
    await peer.setLocalDescription(offer);
    db.ref("offer").set(JSON.stringify(offer));

    // Listen for answer from Admin
    db.ref("answer").on("value", async snap => {
      if(!snap.val()) return;
      const answer = JSON.parse(snap.val());
      await peer.setRemoteDescription(new RTCSessionDescription(answer));
    });
  }

  // ğŸ‘ï¸ Admin Side (Viewer)
  async function startAdmin(){
    peer = new RTCPeerConnection();

    peer.ontrack = e => document.getElementById("video").srcObject = e.streams[0];

    // Send ICE candidates
    peer.onicecandidate = e => {
      if(e.candidate){
        db.ref("adminCandidates").push(e.candidate.toJSON());
      }
    };

    // Listen for offer
    db.ref("offer").on("value", async snap => {
      if(!snap.val()) return;
      const offer = JSON.parse(snap.val());
      await peer.setRemoteDescription(new RTCSessionDescription(offer));

      const answer = await peer.createAnswer();
      await peer.setLocalDescription(answer);
      db.ref("answer").set(JSON.stringify(answer));
    });

    // Listen for Employee ICE candidates
    db.ref("employeeCandidates").on("child_added", snap => {
      if(snap.val()){
        peer.addIceCandidate(new RTCIceCandidate(snap.val()));
      }
    });

    // Listen for Admin ICE candidates (optional, for completeness)
    db.ref("adminCandidates").on("child_added", snap => {
      if(snap.val()){
        peer.addIceCandidate(new RTCIceCandidate(snap.val()));
      }
    });
  }
</script>
</body>
</html>
